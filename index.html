
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Responsibilities Optimizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 5px solid var(--primary);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .subtitle {
            color: #bdc3c7;
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .mobile-notice {
            background: #fff3cd;
            color: #856404;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 15px auto;
            max-width: 800px;
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .mobile-notice {
                display: flex;
            }
        }
        
        .main-content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        
        @media (min-width: 992px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        textarea {
            width: 100%;
            min-height: 250px;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 15px;
            line-height: 1.5;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .input-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background: var(--secondary);
        }
        
        .btn-secondary:hover {
            background: #27ae60;
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-warning:hover {
            background: #d68910;
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .progress-container {
            margin: 20px 0;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            height: 10px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .results-section {
            display: none;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-top: 30px;
            padding: 0 30px;
        }
        
        @media (min-width: 768px) {
            .results-section {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }
        
        .results-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }
        
        .results-card h3 {
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .keyword-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .keyword {
            background: #e3f2fd;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }
        
        .keyword.common {
            background: #d4edda;
            color: #155724;
        }
        
        .keyword.unique {
            background: #fff3cd;
            color: #856404;
        }
        
        .count {
            background: var(--primary);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .optimized-section {
            display: none;
            margin-top: 30px;
            padding: 0 30px 30px;
        }
        
        .optimized-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }
        
        .job-title-suggestion {
            display: inline-block;
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            padding: 12px 20px;
            border-radius: 10px;
            margin: 8px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .footer {
            text-align: center;
            padding: 30px;
            background: var(--dark);
            color: white;
            margin-top: 30px;
        }
        
        .instructions {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 15px;
            border-left: 5px solid var(--primary);
        }
        
        .tab-container {
            display: flex;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: var(--primary);
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            font-weight: 600;
            color: var(--primary);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .cv-tips {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 5px solid var(--warning);
        }
        
        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border-top: 5px solid var(--primary);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 14px;
        }
        
        /* Responsibility Optimization Styles */
        .responsibility-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid var(--primary);
        }
        
        .original-responsibility {
            color: #666;
            font-style: italic;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ddd;
        }
        
        .optimized-responsibility {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            position: relative;
        }
        
        .optimization-badge {
            position: absolute;
            top: -10px;
            right: 10px;
            background: var(--secondary);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .responsibility-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.9rem;
        }
        
        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .copy-btn:hover {
            background: #2980b9;
        }
        
        .responsibility-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        /* Certification Grid Styles */
        .certification-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .certification-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }
        
        .certification-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .cert-header {
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        .cert-header i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: block;
        }
        
        .cert-header h5 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .cert-body {
            padding: 25px;
        }
        
        .cert-body p {
            margin: 10px 0;
            font-size: 14px;
            color: #555;
        }
        
        .btn-cert {
            display: block;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 15px;
            text-align: center;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .btn-cert:hover {
            background: linear-gradient(135deg, #27ae60, #219653);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .container {
                border-radius: 15px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .card {
                padding: 20px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 15px;
            }
            
            .keyword {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            .certification-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-bullseye"></i> CV Responsibilities Optimizer</h1>
            <p class="subtitle">Analyze job descriptions and get optimized key responsibilities for YOUR CV. Paste your current responsibilities and get them optimized for the job market.</p>
            
            <div class="mobile-notice">
                <i class="fas fa-mobile-alt"></i>
                <span>Optimized for mobile devices. Works completely in your browser with no server needed!</span>
            </div>
        </header>
        
        <div class="main-content">
            <div class="card">
                <h2><i class="fas fa-paste"></i> Step 1: Job Descriptions</h2>
                
                <div class="instructions">
                    <p><strong>üìù Paste 5-10 job descriptions</strong> you're targeting (separate with "===="). The tool will extract common requirements to optimize your CV.</p>
                </div>
                
                <div class="input-controls">
                    <button class="btn" id="load-sample">
                        <i class="fas fa-vial"></i> Load Sample Jobs
                    </button>
                    <button class="btn btn-danger" id="clear-jobs">
                        <i class="fas fa-eraser"></i> Clear Jobs
                    </button>
                </div>
                
                <textarea id="jobDescriptions" placeholder="Paste job descriptions here...

Example:
Senior Software Engineer
Looking for senior engineer with 5+ years experience in JavaScript, React, Node.js, and AWS. Must have experience with microservices and CI/CD.

====
Full Stack Developer
Need developer proficient in React, Node.js, Python. Experience with REST APIs, databases, and cloud services required.

====
(Add more job descriptions...)" rows="8"></textarea>
                
                <div class="progress-container" id="progress-container" style="display: none;">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <p>Analyzing job descriptions...</p>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-user-edit"></i> Step 2: Your Current Responsibilities</h2>
                
                <div class="instructions">
                    <p><strong>üìã Paste YOUR current key responsibilities</strong> from your CV. The tool will optimize them based on the job descriptions above.</p>
                    <p style="margin-top:8px;color:#555;">
                        Tip: You can paste bullets like <strong>‚Ä¢</strong> or <strong>-</strong> or <strong>1.</strong> (all supported).
                    </p>
                </div>
                
                <textarea id="cvResponsibilities" placeholder="Paste YOUR current responsibilities here...

Example:
‚Ä¢ Developed web applications using JavaScript
- Collaborated with team members
1. Fixed bugs and issues
* Participated in code reviews
- Worked on backend systems" rows="8"></textarea>
                
                <div class="input-controls">
                    <button class="btn btn-secondary" id="load-sample-cv">
                        <i class="fas fa-vial"></i> Load Sample CV
                    </button>
                    <button class="btn" id="optimize-btn">
                        <i class="fas fa-magic"></i> Optimize My Responsibilities
                    </button>
                </div>
                
                <div class="export-options">
                    <button class="btn btn-warning" id="export-optimized">
                        <i class="fas fa-download"></i> Export Optimized CV
                    </button>
                    <button class="btn btn-secondary" id="save-local">
                        <i class="fas fa-save"></i> Save Progress
                    </button>
                </div>
                
                <div style="margin-top: 20px; font-size: 14px; color: #666; text-align: center;">
                    <i class="fas fa-info-circle"></i> Everything runs in your browser. No data is sent to any server.
                </div>
            </div>
        </div>
        
        <div class="results-section" id="results-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Job Descriptions Analyzed</div>
                    <div class="stat-value" id="jd-count">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Common Requirements Found</div>
                    <div class="stat-value" id="common-skills-count">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Your CV Match Score</div>
                    <div class="stat-value" id="match-score">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Optimized Responsibilities</div>
                    <div class="stat-value" id="optimized-count">0</div>
                </div>
            </div>
            
            <div class="results-card">
                <h3><i class="fas fa-chart-pie"></i> Top Requirements from Job Market</h3>
                <p>Skills appearing in <span id="common-percentage">0%</span> of job descriptions:</p>
                <div class="keyword-list" id="common-keywords"></div>
            </div>
            
            <div class="results-card">
                <h3><i class="fas fa-briefcase"></i> Suggested Job Titles</h3>
                <p>Based on analysis, use these titles in your CV:</p>
                <div id="job-titles"></div>
            </div>
            
            <div class="results-card">
                <h3><i class="fas fa-exclamation-circle"></i> Skills to Add to Your CV</h3>
                <p>These skills are in demand but missing from your responsibilities:</p>
                <div class="keyword-list" id="missing-skills"></div>
            </div>
        </div>
        
        <div class="optimized-section" id="optimized-section">
            <div class="tab-container">
                <div class="tab active" data-tab="optimized-responsibilities">Optimized Responsibilities</div>
                <div class="tab" data-tab="core-competencies">Core Competencies</div>
                <div class="tab" data-tab="comparison">Before vs After</div>
                <div class="tab" data-tab="learning-plan">10-Day Learning Plan</div>
            </div>
            
            <div class="tab-content active" id="optimized-responsibilities">
                <div class="optimized-content">
                    <h3><i class="fas fa-magic"></i> Your Optimized Key Responsibilities</h3>
                    <p>Based on analysis of <span id="jd-count-display">0</span> job descriptions, here are optimized responsibilities you can paste directly into your CV:</p>
                    
                    <div class="responsibility-list" id="optimized-responsibilities-list">
                        <!-- Optimized responsibilities will appear here -->
                    </div>
                    
                    <div class="export-options" style="margin-top: 20px;">
                        <button class="btn btn-secondary" id="copy-all-responsibilities">
                            <i class="fas fa-copy"></i> Copy All to Clipboard
                        </button>
                        <button class="btn" id="download-responsibilities">
                            <i class="fas fa-file-download"></i> Download as Text
                        </button>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="core-competencies">
                <div class="optimized-content">
                    <h3><i class="fas fa-list-check"></i> Core Competencies (Copy & Paste)</h3>
                    <p>These are tailored to the job descriptions and formatted to paste directly into your CV:</p>

                    <div class="responsibility-list" id="core-competencies-list">
                        <!-- Core competencies will appear here -->
                    </div>

                    <div class="export-options" style="margin-top: 20px;">
                        <button class="btn btn-secondary" id="copy-all-competencies">
                            <i class="fas fa-copy"></i> Copy All to Clipboard
                        </button>
                        <button class="btn" id="download-competencies">
                            <i class="fas fa-file-download"></i> Download as Text
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="comparison">
                <div class="optimized-content">
                    <h3><i class="fas fa-exchange-alt"></i> Before vs After Comparison</h3>
                    <div id="comparison-content">
                        <!-- Comparison will appear here -->
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="learning-plan">
                <div class="optimized-content">
                    <div id="learning-plan-content">
                        <!-- Learning plan will appear here -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p><i class="fas fa-laptop-code"></i> https://www.linkedin.com/in/suleman-muhammad/ </p>
            <p>This is Beta Version and for any bugs or issues contact me on suleman.muhammad@hotmail.com ‚Ä¢ 100% browser-based</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Simple state so copy/download never depends on DOM text
            const appState = {
                analysisResults: null,
                optimizationResults: null,
                coreCompetencies: []
            };

            // DOM Elements
            const jobDescriptionsTextarea = document.getElementById('jobDescriptions');
            const cvResponsibilitiesTextarea = document.getElementById('cvResponsibilities');
            const optimizeBtn = document.getElementById('optimize-btn');
            const clearJobsBtn = document.getElementById('clear-jobs');
            const loadSampleBtn = document.getElementById('load-sample');
            const loadSampleCvBtn = document.getElementById('load-sample-cv');
            const resultsSection = document.getElementById('results-section');
            const optimizedSection = document.getElementById('optimized-section');
            const loadingElement = document.getElementById('loading');
            const progressBar = document.getElementById('progress-bar');
            const progressContainer = document.getElementById('progress-container');
            
            // Results elements
            const commonKeywordsContainer = document.getElementById('common-keywords');
            const jobTitlesContainer = document.getElementById('job-titles');
            const missingSkillsContainer = document.getElementById('missing-skills');
            const jdCountElement = document.getElementById('jd-count');
            const jdCountDisplayElement = document.getElementById('jd-count-display');
            const commonPercentageElement = document.getElementById('common-percentage');
            const commonSkillsCountElement = document.getElementById('common-skills-count');
            const matchScoreElement = document.getElementById('match-score');
            const optimizedCountElement = document.getElementById('optimized-count');
            
            // Optimized responsibilities
            const optimizedResponsibilitiesList = document.getElementById('optimized-responsibilities-list');
            const comparisonContent = document.getElementById('comparison-content');
            const learningPlanContent = document.getElementById('learning-plan-content');

            // Core competencies
            const coreCompetenciesList = document.getElementById('core-competencies-list');
            const copyAllCompetenciesBtn = document.getElementById('copy-all-competencies');
            const downloadCompetenciesBtn = document.getElementById('download-competencies');
            
            // Export buttons
            const exportOptimizedBtn = document.getElementById('export-optimized');
            const saveLocalBtn = document.getElementById('save-local');
            const copyAllResponsibilitiesBtn = document.getElementById('copy-all-responsibilities');
            const downloadResponsibilitiesBtn = document.getElementById('download-responsibilities');
            
            // Tab functionality
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Sample data
            const sampleJobDescriptions = [
                "Senior Software Engineer\n\nWe are looking for a Senior Software Engineer with 5+ years of experience in JavaScript, React, and Node.js. The ideal candidate will have experience with cloud platforms (AWS/Azure), CI/CD pipelines, and microservices architecture. Strong communication skills and the ability to work in an Agile environment are required.",
                
                "Full Stack Developer\n\nSeeking a Full Stack Developer proficient in React, Node.js, and Python. Must have experience with REST APIs, database design (SQL/NoSQL), and DevOps practices. Knowledge of Docker, Kubernetes, and cloud services (AWS) is a plus. Excellent problem-solving skills required.",
                
                "Frontend Engineer\n\nLooking for a Frontend Engineer with expertise in React, TypeScript, and modern CSS frameworks. Experience with state management (Redux), testing frameworks (Jest), and build tools (Webpack) is essential. Familiarity with UX/UI principles and responsive design is required.",
                
                "Backend Developer\n\nBackend Developer needed with strong skills in Node.js, Python, and Java. Experience with microservices, API design, database optimization, and cloud infrastructure (AWS/Azure) required. Knowledge of message brokers (Kafka/RabbitMQ) and containerization is a plus.",
                
                "Software Engineer\n\nWe need a Software Engineer with experience in JavaScript/TypeScript, React, and Node.js. Knowledge of cloud platforms, CI/CD, and Agile methodologies is important. Strong analytical skills and ability to collaborate in a team environment are essential."
            ];
            
            const sampleCVResponsibilities = `‚Ä¢ Developed web applications using JavaScript and basic HTML/CSS
- Collaborated with team members on projects
1. Fixed bugs and issues in existing code
* Participated in code reviews and team meetings
- Worked on backend systems with limited database experience
- Assisted in deploying applications to staging environments`;
            
            // Keywords database
            const techKeywords = {
                languages: ['JavaScript', 'TypeScript', 'Python', 'Java', 'C++', 'C#', 'Ruby', 'Go', 'PHP', 'Swift', 'Kotlin'],
                frontend: ['React', 'Angular', 'Vue', 'HTML', 'CSS', 'SASS', 'Bootstrap', 'Webpack', 'Babel'],
                backend: ['Node.js', 'Express', 'Django', 'Flask', 'Spring', 'Laravel', '.NET', 'FastAPI'],
                databases: ['SQL', 'MySQL', 'PostgreSQL', 'MongoDB', 'Redis', 'Oracle', 'Firebase'],
                cloud: ['AWS', 'Azure', 'Google Cloud', 'Docker', 'Kubernetes', 'Terraform'],
                devops: ['CI/CD', 'Microservices', 'REST API', 'GraphQL', 'Git', 'Agile', 'Scrum', 'DevOps'],
                testing: ['Jest', 'Mocha', 'Cypress', 'Selenium', 'JUnit'],
                mobile: ['React Native', 'Flutter', 'iOS', 'Android'],
                data: ['Machine Learning', 'AI', 'Data Science', 'TensorFlow', 'PyTorch']
            };
            
            const softSkills = [
                'Communication', 'Teamwork', 'Leadership', 'Problem Solving', 'Critical Thinking',
                'Adaptability', 'Time Management', 'Creativity', 'Collaboration', 'Analytical Skills'
            ];
            
            // Action verbs for optimization
            const actionVerbs = [
                'Developed', 'Engineered', 'Implemented', 'Designed', 'Built',
                'Created', 'Optimized', 'Improved', 'Enhanced', 'Streamlined',
                'Managed', 'Led', 'Coordinated', 'Directed', 'Supervised',
                'Reduced', 'Increased', 'Accelerated', 'Maximized', 'Minimized',
                'Automated', 'Integrated', 'Deployed', 'Migrated', 'Scaled'
            ];
            
            // Initialize
            initializeApp();
            
            function initializeApp() {
                loadFromLocalStorage();
                
                optimizeBtn.addEventListener('click', optimizeResponsibilities);
                clearJobsBtn.addEventListener('click', clearJobs);
                loadSampleBtn.addEventListener('click', loadSampleJobs);
                loadSampleCvBtn.addEventListener('click', loadSampleCV);
                exportOptimizedBtn.addEventListener('click', exportOptimizedCV);
                saveLocalBtn.addEventListener('click', saveToLocalStorage);
                copyAllResponsibilitiesBtn.addEventListener('click', copyAllResponsibilities);
                downloadResponsibilitiesBtn.addEventListener('click', downloadResponsibilities);

                copyAllCompetenciesBtn.addEventListener('click', copyAllCompetencies);
                downloadCompetenciesBtn.addEventListener('click', downloadCompetencies);
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');
                        switchTab(tabId);
                    });
                });
            }
            
            function switchTab(tabId) {
                tabs.forEach(t => t.classList.remove('active'));
                const activeTab = document.querySelector(`.tab[data-tab="${tabId}"]`);
                if (activeTab) activeTab.classList.add('active');
                
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === tabId) content.classList.add('active');
                });
            }
            
            function loadSampleJobs() {
                jobDescriptionsTextarea.value = sampleJobDescriptions.join('\n\n====\n\n');
                showNotification('Sample job descriptions loaded!', 'success');
            }
            
            function loadSampleCV() {
                cvResponsibilitiesTextarea.value = sampleCVResponsibilities;
                showNotification('Sample CV responsibilities loaded!', 'success');
            }
            
            function clearJobs() {
                jobDescriptionsTextarea.value = '';
                cvResponsibilitiesTextarea.value = '';
                resultsSection.style.display = 'none';
                optimizedSection.style.display = 'none';
                localStorage.removeItem('cvOptimizerData');

                appState.analysisResults = null;
                appState.optimizationResults = null;
                appState.coreCompetencies = [];

                showNotification('All data cleared!', 'info');
            }
            
            function optimizeResponsibilities() {
                const jobDescriptionsText = jobDescriptionsTextarea.value.trim();
                const cvResponsibilitiesText = cvResponsibilitiesTextarea.value.trim();
                
                if (!jobDescriptionsText) {
                    showNotification('Please paste job descriptions first.', 'error');
                    return;
                }
                
                if (!cvResponsibilitiesText) {
                    showNotification('Please paste your current responsibilities.', 'error');
                    return;
                }
                
                showLoading(true);
                
                const jobDescriptions = parseJobDescriptions(jobDescriptionsText);
                
                simulateProgress(() => {
                    const analysisResults = analyzeJobDescriptions(jobDescriptions);
                    const cvResponsibilities = parseCVResponsibilities(cvResponsibilitiesText);

                    if (cvResponsibilities.length === 0) {
                        showLoading(false);
                        showNotification('Could not detect responsibilities. Paste bullets like "-", "‚Ä¢", "*" or numbered "1." lines.', 'error');
                        return;
                    }

                    const optimizationResults = optimizeCVResponsibilities(cvResponsibilities, analysisResults);

                    // Store results in state (fixes copy/download issues)
                    appState.analysisResults = analysisResults;
                    appState.optimizationResults = optimizationResults;
                    
                    displayResults(analysisResults, optimizationResults);
                    displayOptimizedResponsibilities(optimizationResults);
                    displayCoreCompetencies(analysisResults, optimizationResults);
                    displayComparison(cvResponsibilities, optimizationResults);
                    displayLearningPlan(optimizationResults.missingSkills, analysisResults);
                    
                    showLoading(false);
                    showNotification(`Optimized ${optimizationResults.optimizedResponsibilities.length} responsibilities!`, 'success');
                });
            }
            
            function parseJobDescriptions(text) {
                const separators = ['====', '---', '***', '\n\n\n'];
                let descriptions = [];
                
                for (const separator of separators) {
                    if (text.includes(separator)) {
                        descriptions = text.split(separator)
                            .map(desc => desc.trim())
                            .filter(desc => desc.length > 10);
                        break;
                    }
                }
                
                if (descriptions.length <= 1) {
                    descriptions = text.split('\n')
                        .map(desc => desc.trim())
                        .filter(desc => desc.length > 10);
                }
                
                return descriptions;
            }

            // FIXED: robust parsing for bullets: -, ‚Ä¢, *, ‚Äì, ‚Äî, 1., 1), (1) etc + fallback for paragraphs
            function parseCVResponsibilities(text) {
                const lines = text
                    .split('\n')
                    .map(l => l.trim())
                    .filter(Boolean);

                const cleaned = lines
                    .map(line => line.replace(/^(\(?\d+\)?[.)]\s+|[-‚Ä¢*‚Äì‚Äî]\s+)/, '')) // strip leading bullet/number
                    .map(line => line.trim())
                    .filter(line => line.length >= 8);

                if (cleaned.length > 0) return cleaned;

                const fallback = text
                    .replace(/\r/g, ' ')
                    .split(/[.;]\s+|\n+/)
                    .map(s => s.trim())
                    .filter(s => s.length >= 12);

                return fallback;
            }
            
            function analyzeJobDescriptions(descriptions) {
                const keywordFrequency = {};
                const jobTitles = [];
                
                descriptions.forEach(desc => {
                    const title = extractJobTitle(desc);
                    jobTitles.push(title);
                    
                    const keywords = extractKeywordsFromText(desc);
                    keywords.forEach(keyword => {
                        keywordFrequency[keyword] = (keywordFrequency[keyword] || 0) + 1;
                    });
                });
                
                const totalDescriptions = descriptions.length;
                const commonThreshold = Math.max(2, Math.floor(totalDescriptions * 0.4));
                
                const commonKeywords = [];
                Object.entries(keywordFrequency).forEach(([keyword, frequency]) => {
                    if (frequency >= commonThreshold) {
                        commonKeywords.push({ 
                            keyword, 
                            frequency, 
                            percentage: Math.round((frequency / totalDescriptions) * 100) 
                        });
                    }
                });
                
                commonKeywords.sort((a, b) => b.frequency - a.frequency);
                
                const suggestedTitles = generateJobTitles(jobTitles, commonKeywords);
                
                return {
                    commonKeywords,
                    suggestedTitles,
                    totalDescriptions
                };
            }
            
            function extractJobTitle(text) {
                const lines = text.split('\n');
                if (lines.length > 0) {
                    const firstLine = lines[0].trim();
                    if (firstLine.length < 100) {
                        return firstLine;
                    }
                }
                
                const patterns = [
                    /(?:looking for|seeking|hiring|position:|title:|role:)\s*([^\n,.]+)/i,
                    /^([^\n]+?)\s*(?:engineer|developer|analyst|specialist|manager)/i
                ];
                
                for (const pattern of patterns) {
                    const match = text.match(pattern);
                    if (match && match[1]) {
                        return match[1].trim().replace(/[^\w\s]/g, '');
                    }
                }
                
                return "Software Developer";
            }
            
            function extractKeywordsFromText(text) {
                const textLower = text.toLowerCase();
                const foundKeywords = new Set();
                
                Object.values(techKeywords).flat().forEach(keyword => {
                    if (textLower.includes(keyword.toLowerCase())) {
                        foundKeywords.add(keyword);
                    }
                });
                
                softSkills.forEach(skill => {
                    if (textLower.includes(skill.toLowerCase())) {
                        foundKeywords.add(skill);
                    }
                });
                
                return Array.from(foundKeywords);
            }
            
            function generateJobTitles(existingTitles, commonKeywords) {
                const titleCount = {};
                existingTitles.forEach(title => {
                    titleCount[title] = (titleCount[title] || 0) + 1;
                });
                
                const frequentTitles = Object.entries(titleCount)
                    .sort((a, b) => b[1] - a[1])
                    .map(entry => entry[0])
                    .slice(0, 3);
                
                const generatedTitles = [];
                
                let seniority = '';
                const seniorKeywords = ['Senior', 'Lead', 'Principal', 'Head'];
                const hasSeniorKeyword = commonKeywords.some(k => 
                    seniorKeywords.some(sk => k.keyword.includes(sk))
                );
                
                if (hasSeniorKeyword) {
                    seniority = 'Senior ';
                }
                
                let focusArea = 'Full Stack';
                const keywordText = commonKeywords.map(k => k.keyword).join(' ').toLowerCase();
                
                const focusAreas = {
                    'Frontend': ['react', 'angular', 'vue', 'frontend', 'javascript', 'typescript', 'css'],
                    'Backend': ['node', 'python', 'java', 'backend', 'api', 'server', 'database'],
                    'DevOps': ['aws', 'azure', 'docker', 'kubernetes', 'devops', 'ci/cd', 'terraform'],
                    'Data': ['data', 'machine learning', 'ai', 'analytics', 'python', 'sql']
                };
                
                let maxScore = 0;
                Object.entries(focusAreas).forEach(([area, keywords]) => {
                    let score = 0;
                    keywords.forEach(keyword => {
                        if (keywordText.includes(keyword)) {
                            score++;
                        }
                    });
                    
                    if (score > maxScore) {
                        maxScore = score;
                        focusArea = area;
                    }
                });
                
                generatedTitles.push(`${seniority}${focusArea} Developer`);
                generatedTitles.push(`${seniority}${focusArea} Engineer`);
                generatedTitles.push(`${seniority}Software Engineer`);
                
                const allTitles = [...new Set([...frequentTitles, ...generatedTitles])];
                return allTitles.slice(0, 5);
            }
            
            function optimizeCVResponsibilities(cvResponsibilities, jobAnalysis) {
                const optimizedResponsibilities = [];
                const matchedSkills = [];
                const missingSkills = [];
                
                cvResponsibilities.forEach(responsibility => {
                    const optimized = optimizeSingleResponsibility(responsibility, jobAnalysis.commonKeywords);
                    optimizedResponsibilities.push(optimized);
                    
                    jobAnalysis.commonKeywords.forEach(commonSkill => {
                        const skill = commonSkill.keyword;
                        const responsibilityLower = responsibility.toLowerCase();
                        if (responsibilityLower.includes(skill.toLowerCase())) {
                            if (!matchedSkills.includes(skill)) {
                                matchedSkills.push(skill);
                            }
                        }
                    });
                });
                
                jobAnalysis.commonKeywords.forEach(commonSkill => {
                    const skill = commonSkill.keyword;
                    if (!matchedSkills.includes(skill)) {
                        missingSkills.push(skill);
                    }
                });
                
                const matchScore = jobAnalysis.commonKeywords.length > 0 
                    ? Math.round((matchedSkills.length / jobAnalysis.commonKeywords.length) * 100)
                    : 0;
                
                return {
                    originalResponsibilities: cvResponsibilities,
                    optimizedResponsibilities,
                    matchedSkills,
                    missingSkills,
                    matchScore
                };
            }
            
            function optimizeSingleResponsibility(responsibility, commonKeywords) {
                let optimized = responsibility;
                
                const commonSkills = commonKeywords.map(k => k.keyword);
                
                commonSkills.forEach(skill => {
                    const skillLower = skill.toLowerCase();
                    const responsibilityLower = responsibility.toLowerCase();
                    
                    if (!responsibilityLower.includes(skillLower)) {
                        const relatedKeywords = getRelatedKeywords(skill);
                        
                        relatedKeywords.forEach(relatedSkill => {
                            const relatedLower = relatedSkill.toLowerCase();
                            if (responsibilityLower.includes(relatedLower)) {
                                optimized = optimized.replace(
                                    new RegExp(escapeRegExp(relatedSkill), 'gi'),
                                    `${relatedSkill} and ${skill}`
                                );
                            }
                        });
                    }
                });
                
                if (optimized === responsibility) {
                    optimized = enhanceResponsibility(responsibility, commonSkills);
                }
                
                return optimized;
            }
            
            function getRelatedKeywords(skill) {
                const relatedMap = {
                    'React': ['JavaScript', 'Frontend', 'UI', 'User Interface'],
                    'Node.js': ['JavaScript', 'Backend', 'Server'],
                    'AWS': ['Cloud', 'Infrastructure', 'Deployment'],
                    'Python': ['Backend', 'Scripting', 'Automation'],
                    'SQL': ['Database', 'MySQL', 'PostgreSQL'],
                    'Docker': ['Containerization', 'Deployment', 'DevOps'],
                    'CI/CD': ['Automation', 'Deployment', 'Pipeline'],
                    'Microservices': ['Architecture', 'Scalability', 'Distributed'],
                    'TypeScript': ['JavaScript', 'Type Safety', 'Frontend'],
                    'MongoDB': ['Database', 'NoSQL', 'Document']
                };
                
                return relatedMap[skill] || [];
            }
            
            function enhanceResponsibility(responsibility, commonSkills) {
                let enhanced = responsibility;
                
                actionVerbs.forEach(verb => {
                    if (enhanced.toLowerCase().startsWith(verb.toLowerCase())) {
                        enhanced = enhanced.replace(verb, getStrongerVerb(verb));
                    }
                });
                
                if (!/\d+%/.test(enhanced) && !/\d+\+/.test(enhanced)) {
                    const quantifiers = [
                        ' by 30%', ' by 40%', ' by 50%',
                        ' for 1000+ users', ' across 5+ teams',
                        ' reducing time by 60%', ' increasing efficiency by 70%'
                    ];
                    
                    const randomQuantifier = quantifiers[Math.floor(Math.random() * quantifiers.length)];
                    if (!enhanced.endsWith('.') && !enhanced.endsWith('!')) {
                        enhanced += randomQuantifier;
                    }
                }
                
                const relevantSkills = commonSkills.filter(skill => 
                    !enhanced.toLowerCase().includes(skill.toLowerCase())
                ).slice(0, 2);
                
                if (relevantSkills.length > 0) {
                    enhanced += ` using ${relevantSkills.join(' and ')}`;
                }
                
                return enhanced;
            }
            
            function getStrongerVerb(verb) {
                const verbMap = {
                    'Developed': 'Engineered',
                    'Built': 'Architected',
                    'Made': 'Developed',
                    'Worked': 'Spearheaded',
                    'Helped': 'Orchestrated',
                    'Assisted': 'Directed',
                    'Did': 'Implemented',
                    'Fixed': 'Optimized',
                    'Used': 'Leveraged',
                    'Created': 'Pioneered'
                };
                
                return verbMap[verb] || verb;
            }

            function displayResults(analysisResults, optimizationResults) {
                resultsSection.style.display = 'grid';
                optimizedSection.style.display = 'block';
                
                jdCountElement.textContent = analysisResults.totalDescriptions;
                jdCountDisplayElement.textContent = analysisResults.totalDescriptions;
                commonSkillsCountElement.textContent = analysisResults.commonKeywords.length;
                matchScoreElement.textContent = `${optimizationResults.matchScore}%`;
                optimizedCountElement.textContent = optimizationResults.optimizedResponsibilities.length;
                
                const commonPercentage = analysisResults.commonKeywords.length > 0 
                    ? Math.round((analysisResults.commonKeywords[0].frequency / analysisResults.totalDescriptions) * 100)
                    : 0;
                commonPercentageElement.textContent = `${commonPercentage}%`;
                
                commonKeywordsContainer.innerHTML = '';
                analysisResults.commonKeywords.slice(0, 10).forEach(item => {
                    const keywordElement = createKeywordElement(item.keyword, item.frequency, 'common');
                    commonKeywordsContainer.appendChild(keywordElement);
                });
                
                jobTitlesContainer.innerHTML = '';
                analysisResults.suggestedTitles.forEach(title => {
                    const titleElement = document.createElement('div');
                    titleElement.className = 'job-title-suggestion';
                    titleElement.innerHTML = `<i class="fas fa-briefcase"></i> ${escapeHtml(title)}`;
                    jobTitlesContainer.appendChild(titleElement);
                });
                
                missingSkillsContainer.innerHTML = '';
                optimizationResults.missingSkills.slice(0, 10).forEach(skill => {
                    const skillElement = createKeywordElement(skill, 0, 'unique');
                    missingSkillsContainer.appendChild(skillElement);
                });
                
                switchTab('optimized-responsibilities');
            }
            
            function createKeywordElement(keyword, frequency, type) {
                const element = document.createElement('div');
                element.className = `keyword ${type}`;
                
                const icon = type === 'common' ? 'fa-check-circle' : 'fa-star';
                element.innerHTML = `
                    <i class="fas ${icon}"></i> 
                    ${escapeHtml(keyword)} 
                    ${frequency > 0 ? `<span class="count">${frequency}</span>` : ''}
                `;
                
                return element;
            }
            
            function displayOptimizedResponsibilities(optimizationResults) {
                optimizedResponsibilitiesList.innerHTML = '';
                
                optimizationResults.optimizedResponsibilities.forEach((optimized, index) => {
                    const responsibilityBox = document.createElement('div');
                    responsibilityBox.className = 'responsibility-box';
                    
                    const original = optimizationResults.originalResponsibilities[index] || '';
                    
                    responsibilityBox.innerHTML = `
                        ${original ? `<div class="original-responsibility"><strong>Original:</strong> ${escapeHtml(original)}</div>` : ''}
                        <div class="optimized-responsibility">
                            <span class="optimization-badge">Optimized</span>
                            <strong>${index + 1}.</strong> ${escapeHtml(optimized)}
                        </div>
                        <div class="responsibility-actions">
                            <button class="copy-btn" data-type="responsibility" data-index="${index}">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button class="btn btn-small btn-secondary" onclick="editResponsibility(${index})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                    `;
                    
                    optimizedResponsibilitiesList.appendChild(responsibilityBox);
                });
                
                optimizedResponsibilitiesList.querySelectorAll('.copy-btn[data-type="responsibility"]').forEach(button => {
                    button.addEventListener('click', function() {
                        const idx = Number(this.getAttribute('data-index'));
                        const text = appState.optimizationResults?.optimizedResponsibilities?.[idx];
                        if (!text) {
                            showNotification('Nothing to copy.', 'error');
                            return;
                        }
                        navigator.clipboard.writeText(`- ${text}`).then(() => {
                            showNotification('Responsibility copied to clipboard!', 'success');
                        });
                    });
                });
            }

            // -------- Core Competencies (NEW TAB) --------
            function buildCoreCompetencies(analysisResults, optimizationResults) {
                const common = (analysisResults?.commonKeywords || []).map(k => k.keyword);
                const missing = optimizationResults?.missingSkills || [];
                const matched = optimizationResults?.matchedSkills || [];

                const pool = [...common, ...matched, ...missing];

                const toCompetency = (skill) => {
                    const map = {
                        'CI/CD': 'CI/CD Pipeline Implementation',
                        'Microservices': 'Microservices Architecture & Scalability',
                        'REST API': 'REST API Design & Integration',
                        'AWS': 'AWS Cloud Deployment & Infrastructure',
                        'Azure': 'Azure Cloud Services & Deployment',
                        'Google Cloud': 'Google Cloud Platform (GCP) Deployment',
                        'Docker': 'Docker Containerization & Delivery',
                        'Kubernetes': 'Kubernetes Orchestration & Scaling',
                        'React': 'React Frontend Development',
                        'TypeScript': 'TypeScript & Modern JavaScript',
                        'JavaScript': 'JavaScript (ES6+) Development',
                        'Node.js': 'Node.js Backend Development',
                        'SQL': 'SQL Database Design & Optimization',
                        'MongoDB': 'NoSQL (MongoDB) Data Modeling',
                        'Agile': 'Agile Delivery & Scrum Collaboration',
                        'DevOps': 'DevOps Practices & Automation',
                        'Git': 'Version Control (Git) & Code Review',
                        'Communication': 'Stakeholder Communication & Collaboration',
                        'Problem Solving': 'Analytical Problem Solving',
                        'Testing': 'Automated Testing & Quality Assurance'
                    };
                    return map[skill] || `${skill} Proficiency`;
                };

                const unique = [];
                const seen = new Set();

                for (const s of pool) {
                    if (!s) continue;
                    const c = toCompetency(s);
                    const key = c.toLowerCase();
                    if (!seen.has(key)) {
                        seen.add(key);
                        unique.push(c);
                    }
                    if (unique.length >= 14) break;
                }

                return unique;
            }

            function displayCoreCompetencies(analysisResults, optimizationResults) {
                appState.coreCompetencies = buildCoreCompetencies(analysisResults, optimizationResults);
                coreCompetenciesList.innerHTML = '';

                if (!appState.coreCompetencies || appState.coreCompetencies.length === 0) {
                    coreCompetenciesList.innerHTML = `<p style="color:#666;">No competencies generated yet. Add job descriptions + responsibilities and click Optimize.</p>`;
                    return;
                }

                appState.coreCompetencies.forEach((comp, idx) => {
                    const box = document.createElement('div');
                    box.className = 'responsibility-box';
                    box.innerHTML = `
                        <div class="optimized-responsibility">
                            <span class="optimization-badge">CV Ready</span>
                            <strong>${idx + 1}.</strong> ${escapeHtml(comp)}
                        </div>
                        <div class="responsibility-actions">
                            <button class="copy-btn" data-type="competency" data-index="${idx}">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                    `;
                    coreCompetenciesList.appendChild(box);
                });

                coreCompetenciesList.querySelectorAll('.copy-btn[data-type="competency"]').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const idx = Number(this.getAttribute('data-index'));
                        const text = appState.coreCompetencies?.[idx];
                        if (!text) {
                            showNotification('Nothing to copy.', 'error');
                            return;
                        }
                        navigator.clipboard.writeText(`- ${text}`).then(() => {
                            showNotification('Competency copied to clipboard!', 'success');
                        });
                    });
                });
            }

            function copyAllCompetencies() {
                if (!appState.coreCompetencies || appState.coreCompetencies.length === 0) {
                    showNotification('No core competencies to copy.', 'error');
                    return;
                }
                const text = appState.coreCompetencies.map(c => `- ${c}`).join('\n');
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('All core competencies copied!', 'success');
                });
            }

            function downloadCompetencies() {
                if (!appState.coreCompetencies || appState.coreCompetencies.length === 0) {
                    showNotification('No core competencies to download.', 'error');
                    return;
                }

                let text = 'CORE COMPETENCIES (CV READY)\n';
                text += 'Generated: ' + new Date().toLocaleString() + '\n\n';
                text += appState.coreCompetencies.map(c => `- ${c}`).join('\n');

                downloadTextFile(text, 'core-competencies.txt');
                showNotification('Core competencies downloaded!', 'success');
            }
            // -------------------------------------------

            function displayComparison(cvResponsibilities, optimizationResults) {
                comparisonContent.innerHTML = '';
                
                const comparisonDiv = document.createElement('div');
                comparisonDiv.innerHTML = `
                    <h4><i class="fas fa-balance-scale"></i> Before vs After Comparison</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div>
                            <h5 style="color: #e74c3c;"><i class="fas fa-times-circle"></i> Original Responsibilities</h5>
                            <div style="background: #f8d7da; padding: 15px; border-radius: 8px; max-height: 400px; overflow-y: auto;">
                                ${cvResponsibilities.map((r, i) => `<p><strong>${i + 1}.</strong> ${escapeHtml(r)}</p>`).join('')}
                            </div>
                        </div>
                        <div>
                            <h5 style="color: #2ecc71;"><i class="fas fa-check-circle"></i> Optimized Responsibilities</h5>
                            <div style="background: #d4edda; padding: 15px; border-radius: 8px; max-height: 400px; overflow-y: auto;">
                                ${optimizationResults.optimizedResponsibilities.map((r, i) => `<p><strong>${i + 1}.</strong> ${escapeHtml(r)}</p>`).join('')}
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: #e8f4fc; border-radius: 8px;">
                        <h5><i class="fas fa-chart-line"></i> Improvement Summary</h5>
                        <p><strong>Match Score:</strong> Your responsibilities now match ${optimizationResults.matchScore}% of market requirements</p>
                        <p><strong>Missing Skills Identified:</strong> ${optimizationResults.missingSkills.length}</p>
                        <p><strong>Impact Statements:</strong> Quantifiable results added to ~${Math.round(optimizationResults.optimizedResponsibilities.length * 0.7)} responsibilities</p>
                    </div>
                `;
                
                comparisonContent.appendChild(comparisonDiv);
            }
            
            function displayLearningPlan(missingSkills, analysisResults) {
                learningPlanContent.innerHTML = `
                    <div class="cv-tips">
                        <h4><i class="fas fa-rocket"></i> 10-Day Learning Plan for Missing Skills</h4>
                        <p>Focus on these ${missingSkills.length} skills to become a stronger match:</p>
                        
                        <div class="certification-grid">
                            ${generateCertificationCards(missingSkills)}
                        </div>
                        
                        <h4 style="margin-top: 30px;"><i class="fas fa-calendar-alt"></i> Daily Learning Schedule</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <p><strong>Days 1-3:</strong> Master ${escapeHtml(missingSkills.slice(0, 2).join(' and ') || 'priority skills')} with hands-on projects</p>
                            <p><strong>Days 4-7:</strong> Learn ${escapeHtml(missingSkills.slice(2, 4).join(' and ') || 'supporting skills')} through crash courses</p>
                            <p><strong>Days 8-10:</strong> Build a portfolio project combining key skills</p>
                        </div>
                    </div>
                `;
            }
            
            function generateCertificationCards(missingSkills) {
                const certs = [
                    {
                        title: "AWS Cloud Practitioner",
                        platform: "AWS Training",
                        time: "6 hours",
                        link: "https://aws.amazon.com/training/digital/aws-cloud-practitioner-essentials/",
                        icon: "fa-cloud"
                    },
                    {
                        title: "React - The Complete Guide",
                        platform: "Udemy",
                        time: "8 hours (at 2x speed)",
                        link: "https://www.udemy.com/course/react-the-complete-guide-incl-redux/",
                        icon: "fa-react"
                    },
                    {
                        title: "Node.js Bootcamp",
                        platform: "Udemy",
                        time: "10 hours",
                        link: "https://www.udemy.com/course/nodejs-express-mongodb-bootcamp/",
                        icon: "fa-node-js"
                    },
                    {
                        title: "Docker Mastery",
                        platform: "Udemy",
                        time: "12 hours",
                        link: "https://www.udemy.com/course/docker-mastery/",
                        icon: "fa-docker"
                    }
                ];
                
                return certs.map(cert => `
                    <div class="certification-card">
                        <div class="cert-header">
                            <i class="fas ${cert.icon}"></i>
                            <h5>${escapeHtml(cert.title)}</h5>
                        </div>
                        <div class="cert-body">
                            <p><strong>Platform:</strong> ${escapeHtml(cert.platform)}</p>
                            <p><strong>Duration:</strong> ${escapeHtml(cert.time)}</p>
                            <a href="${cert.link}" target="_blank" class="btn-cert" rel="noopener noreferrer">Start Learning</a>
                        </div>
                    </div>
                `).join('');
            }

            // FIXED: Copy from state, not from DOM text (prevents "No optimized responsibilities to copy" when DOM changes)
            function copyAllResponsibilities() {
                const list = appState.optimizationResults?.optimizedResponsibilities || [];
                if (list.length === 0) {
                    showNotification('No optimized responsibilities to copy.', 'error');
                    return;
                }
                const text = list.map(r => `- ${r}`).join('\n');
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('All responsibilities copied to clipboard!', 'success');
                });
            }
            
            function downloadResponsibilities() {
                const list = appState.optimizationResults?.optimizedResponsibilities || [];
                if (list.length === 0) {
                    showNotification('No optimized responsibilities to download.', 'error');
                    return;
                }
                
                let text = 'OPTIMIZED CV RESPONSIBILITIES\n';
                text += 'Generated: ' + new Date().toLocaleString() + '\n\n';
                text += list.map(r => `- ${r}`).join('\n');
                
                downloadTextFile(text, 'optimized-cv-responsibilities.txt');
                showNotification('Responsibilities downloaded!', 'success');
            }
            
            function exportOptimizedCV() {
                const list = appState.optimizationResults?.optimizedResponsibilities || [];
                if (list.length === 0) {
                    showNotification('Optimize responsibilities first.', 'error');
                    return;
                }
                
                const jobTitles = Array.from(document.querySelectorAll('.job-title-suggestion'))
                    .map(el => el.textContent.trim())
                    .slice(0, 3);
                
                let text = 'OPTIMIZED CV CONTENT\n';
                text += '='.repeat(50) + '\n\n';
                text += 'SUGGESTED JOB TITLES:\n';
                jobTitles.forEach(title => {
                    text += `- ${title}\n`;
                });
                
                text += '\nOPTIMIZED KEY RESPONSIBILITIES:\n';
                list.forEach(r => {
                    text += `- ${r}\n`;
                });

                if (appState.coreCompetencies && appState.coreCompetencies.length > 0) {
                    text += '\nCORE COMPETENCIES:\n';
                    appState.coreCompetencies.forEach(c => {
                        text += `- ${c}\n`;
                    });
                }
                
                const missingSkills = (appState.optimizationResults?.missingSkills || []);
                if (missingSkills.length > 0) {
                    text += '\nSKILLS TO HIGHLIGHT:\n';
                    missingSkills.forEach(skill => {
                        text += `- ${skill}\n`;
                    });
                }
                
                downloadTextFile(text, 'optimized-cv-content.txt');
                showNotification('Optimized CV content downloaded!', 'success');
            }
            
            function downloadTextFile(content, filename) {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            function saveToLocalStorage() {
                const data = {
                    jobDescriptions: jobDescriptionsTextarea.value,
                    cvResponsibilities: cvResponsibilitiesTextarea.value,
                    timestamp: new Date().toISOString()
                };
                
                try {
                    localStorage.setItem('cvOptimizerData', JSON.stringify(data));
                    showNotification('Progress saved!', 'success');
                } catch (e) {
                    showNotification('Could not save data.', 'error');
                }
            }
            
            function loadFromLocalStorage() {
                try {
                    const savedData = localStorage.getItem('cvOptimizerData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        jobDescriptionsTextarea.value = data.jobDescriptions || '';
                        cvResponsibilitiesTextarea.value = data.cvResponsibilities || '';
                    }
                } catch (e) {
                    // Silently fail
                }
            }
            
            function showLoading(show) {
                if (show) {
                    loadingElement.style.display = 'block';
                    progressContainer.style.display = 'block';
                    progressBar.style.width = '0%';
                } else {
                    loadingElement.style.display = 'none';
                    progressContainer.style.display = 'none';
                }
            }
            
            function simulateProgress(callback) {
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 2;
                    progressBar.style.width = `${progress}%`;
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        setTimeout(callback, 300);
                    }
                }, 30);
            }
            
            function showNotification(message, type) {
                const existingNotification = document.querySelector('.notification');
                if (existingNotification) {
                    existingNotification.remove();
                }
                
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                
                let icon = 'fa-info-circle';
                let bgColor = '#3498db';
                
                switch (type) {
                    case 'success': icon = 'fa-check-circle'; bgColor = '#2ecc71'; break;
                    case 'error': icon = 'fa-exclamation-circle'; bgColor = '#e74c3c'; break;
                    case 'warning': icon = 'fa-exclamation-triangle'; bgColor = '#f39c12'; break;
                }
                
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${bgColor};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    z-index: 1000;
                    max-width: 400px;
                    animation: slideIn 0.3s ease;
                `;
                
                document.body.appendChild(notification);
                
                notification.innerHTML = `
                    <i class="fas ${icon}"></i>
                    <span>${escapeHtml(message)}</span>
                `;
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 5000);
                
                if (!document.querySelector('#notification-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-styles';
                    style.textContent = `
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        @keyframes slideOut {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                notification.addEventListener('click', () => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                });
            }

            // Helpers
            function escapeHtml(str) {
                return String(str)
                    .replaceAll('&', '&amp;')
                    .replaceAll('<', '&lt;')
                    .replaceAll('>', '&gt;')
                    .replaceAll('"', '&quot;')
                    .replaceAll("'", '&#039;');
            }
            function escapeRegExp(string) {
                return String(string).replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }
            
            // Make edit function available globally (and keep state updated)
            window.editResponsibility = function(index) {
                const current = appState.optimizationResults?.optimizedResponsibilities?.[index];
                if (!current) {
                    showNotification('Nothing to edit.', 'error');
                    return;
                }

                const newText = prompt('Edit this responsibility:', current);
                if (newText && newText.trim() !== '') {
                    appState.optimizationResults.optimizedResponsibilities[index] = newText.trim();

                    // Re-render responsibilities + comparison (to reflect edits)
                    displayOptimizedResponsibilities(appState.optimizationResults);
                    displayComparison(
                        appState.optimizationResults.originalResponsibilities || [],
                        appState.optimizationResults
                    );

                    showNotification('Responsibility updated!', 'success');
                }
            };
        });
    </script>
</body>
</html>
